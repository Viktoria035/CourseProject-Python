<!-- filepath: d:\Projects\python\Project\app\gui\templates\quiz\multiplayer.html -->
{% extends "quiz/base.html" %}
{% block content %}
{% include "quiz/header.html" %}

<div class="card-columns" style="padding: 10px; margin: 20px;"></div>

<div class="rules">
    <h1>Here are some of the rules for the multiplayer game:</h1>
    <ul><h1>
        <li>Each player will be given a question to answer.</li>
        <li>The next question will be displayed only after all players have answered the current question.</li>
        <li>Questions can have one or multiple answer/s. Be careful!</li>
        <li>The results will be displayed after all players have answered the last question.</li>
        <li>The answers are with different points.</li>
        <li>The player with the highest score at the end of the game will be declared the winner.</li>
    </ul></h1>
    <h1>To start and proceed to the questions click down below.</h1>
</div>

<div id="question-container" style="display: flex; justify-content: center;">
    <a href="#" id="start-quiz" style="font-size: 2.5rem;">Question</a>
</div>
<div id="results-container"></div>

<script>
    const room_code = '{{ room_code }}';
    const username = '{{ username }}';
    const player = '{{ player }}';
    const quiz = '{{ quiz }}';

    const quizSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/multiplayer/' + room_code + '/'
    );

    document.getElementById("start-quiz").addEventListener("click", function(event) {
        event.preventDefault();  // Предотвратява презареждане на страницата
        quizSocket.send(JSON.stringify({
            "type": "start_game",
            "username": username
        }));
    });

    quizSocket.onmessage = function(event) {
        const data = JSON.parse(event.data);

        if (data.room_code === undefined || data.room_code === null) {
            console.error("Invalid room code: ", data.room_code);
            return;
        }

        if (data.question.open_in_new_tab) {
            window.open(data.question.url, '_blank');
        } else {
            window.location.href = data.question.url;
        }
        
        if (data.type === "show_question") {
            document.getElementById("question-container").innerHTML = `
                <a href="${data.question.url}" style="font-size: 2.5rem;">Question</a>
            `;
        }
    };
</script>
{% endblock %}